<!DOCTYPE html>
<html>
<head>
    <title>Color Order Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #colors {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .color-box {
            width: 50px;
            height: 50px;
            margin: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #000;
            cursor: pointer;
        }
        .color-box[data-id="0"] { background-color: pink; }
        .color-box[data-id="1"] { background-color: red; }
        .color-box[data-id="2"] { background-color: orange; }
        .color-box[data-id="3"] { background-color: blue; }
        .color-box[data-id="4"] { background-color: green; }
        #playerinput {
            display: flex;
            justify-content: center;
            min-height: 60px;
        }
        .drop-zone {
            width: 50px;
            height: 50px;
            margin: 5px;
            border: 1px dashed #000;
        }
        #message {
            margin-top: 20px;
        }
    </style>
</head>
<body>

<h1>Color Order Game</h1>
<p>Drag and drop the colored boxes in the order you think is correct.</p>

<div id="colors">
    <div class="color-box" draggable="true" data-id="0">0</div>
    <div class="color-box" draggable="true" data-id="1">1</div>
    <div class="color-box" draggable="true" data-id="2">2</div>
    <div class="color-box" draggable="true" data-id="3">3</div>
    <div class="color-box" draggable="true" data-id="4">4</div>
</div>

<div id="playerinput">
    <div class="drop-zone"></div>
    <div class="drop-zone"></div>
    <div class="drop-zone"></div>
    <div class="drop-zone"></div>
    <div class="drop-zone"></div>
</div>

<button onclick="checkInput()">Submit</button>

<p id="message"></p>
<p id="lastinput" class="hidden"></p>

<script>
    const olst = ['0: Pink', '1: Red', '2: Orange', '3: Blue', '4: Green'];
    let gamelst = ['0', '1', '2', '3', '4'];

    while (gamelst.toString() === ['0', '1', '2', '3', '4'].toString()) {
        gamelst = gamelst.sort(() => Math.random() - 0.5);
    }

    let trynumber = 1;
    let error = false;
    let count = 0;

    const colorBoxes = document.querySelectorAll('.color-box');
    const dropZones = document.querySelectorAll('.drop-zone');

    colorBoxes.forEach(box => {
        box.addEventListener('dragstart', dragStart);
        box.addEventListener('touchstart', touchStart);
        box.addEventListener('touchmove', touchMove);
        box.addEventListener('touchend', touchEnd);
    });

    dropZones.forEach(zone => {
        zone.addEventListener('dragover', dragOver);
        zone.addEventListener('drop', drop);
        zone.addEventListener('touchmove', touchMove);
        zone.addEventListener('touchend', touchEnd);
    });

    let touchElement = null;

    function dragStart(event) {
        event.dataTransfer.setData('text/plain', event.target.dataset.id);
    }

    function touchStart(event) {
        touchElement = event.target;
        event.target.style.position = 'absolute';
        event.target.style.zIndex = 1000;
        moveAt(event.touches[0].pageX, event.touches[0].pageY);
    }

    function touchMove(event) {
        event.preventDefault();
        if (touchElement) {
            moveAt(event.touches[0].pageX, event.touches[0].pageY);
        }
    }

    function touchEnd(event) {
        if (touchElement) {
            touchElement.style.position = '';
            touchElement.style.zIndex = '';
            touchElement = null;
        }

        const dropZone = document.elementFromPoint(event.changedTouches[0].clientX, event.changedTouches[0].clientY);
        if (dropZone && (dropZone.classList.contains('drop-zone') || dropZone.classList.contains('color-box'))) {
            drop({target: dropZone});
        }
    }

    function moveAt(pageX, pageY) {
        touchElement.style.left = pageX - touchElement.offsetWidth / 2 + 'px';
        touchElement.style.top = pageY - touchElement.offsetHeight / 2 + 'px';
    }

    function dragOver(event) {
        event.preventDefault();
    }

    function drop(event) {
        event.preventDefault();
        const draggedId = touchElement ? touchElement.dataset.id : event.dataTransfer.getData('text/plain');
        const draggedBox = document.querySelector(`.color-box[data-id="${draggedId}"]`);

        if (event.target.classList.contains('drop-zone')) {
            if (event.target.hasChildNodes()) {
                const existingBox = event.target.firstChild;
                const originalZone = draggedBox.parentElement;

                event.target.replaceChild(draggedBox, existingBox);
                originalZone.appendChild(existingBox);
            } else {
                event.target.appendChild(draggedBox);
            }
        } else if (event.target.classList.contains('color-box')) {
            const targetBox = event.target;
            const originalZone = draggedBox.parentElement;
            const targetZone = targetBox.parentElement;

            targetZone.replaceChild(draggedBox, targetBox);
            originalZone.appendChild(targetBox);
        }
    }

    function checkInput() {
        const playerinputlst = Array.from(document.querySelectorAll('.drop-zone')).map(zone => {
            if (zone.hasChildNodes()) {
                return zone.firstChild.dataset.id;
            } else {
                return '';
            }
        });

        let message = '';
        error = false;

        if (trynumber === 1) {
            document.getElementById('message').innerHTML = '';
        }
        
        if (playerinputlst.includes('')) {
            message = "ERROR: You need to use all boxes.\nTry again\n\n";
            error = true;
        } else {
            for (let i = 0; i < 5; i++) {
                if (!playerinputlst.includes(String(i))) {
                    message = 'ERROR: ' + i + ' is missing from your input\nTry again\n\n';
                    error = true;
                }
            }
        }

        if (!error) {
            count = 0;
            for (let i = 0; i < playerinputlst.length; i++) {
                if (playerinputlst[i] === gamelst[i]) {
                    count += 1;
                }
            }
            if (count === 5) {
                message = 'You WON!! in ' + trynumber + ' tries';
            } else {
                message = 'You got ' + count + ' correct\nTry again\n';
                trynumber += 1;
                document.getElementById('lastinput').innerText = 'Your last input was ' + playerinputlst.join(',');
                document.getElementById('lastinput').classList.remove('hidden');
            }
        }

        document.getElementById('message').innerText = message;
        document.getElementById('instructions').innerText = 'TRY NUMBER: ' + trynumber + ' out of 10\nEnter what order you think this list is in:\n' + olst.join(', ');

        if (trynumber > 10) {
            document.getElementById('message').innerText = 'Game Over! You used all 10 tries.';
        }
    }
</script>

</body>
</html>
